<html>
<head>
<title>
FlashFX API: Driver Framework: Compaction
</title>

<style type="text/css">

<!--
/*  TwinText Style (c) PTLogica 2002 - 2004  */

 
/* Body */
body{font-family:"Verdana", sans-serif;font-size: 8pt; }

/* Body (Chapter) */
body.Main{background: #FFFFFF;color: #000000;  margin: 0;       }

/*IE 5.5 */
li, table {  font-family: "Verdana", sans-serif; font-size: 8pt;  }

/* Project Title */
div.ProjectTitle {
	font-style: italic;
	font-size: 8pt;
	font-weight: normal;
	color: White;
	text-align: left;
	padding-bottom: 3px;
}

/* Chapter's Title */
h1{font-family:"Verdana", sans-serif;font-size: 14px;
font-weight: bold;text-align: left;margin-left: 0pt;margin-right: 0pt;margin-top: 0px;margin-bottom: 9px;    padding-top: 15px;  padding-bottom: 15px;  padding-left: 10px;  background-color: #006699;  color: White;
 border-bottom: 4px solid Black;}
 
/* Feedback */
div.Feedback {
 	font-style: italic;
	font-size: 8pt;
	font-weight: normal;
    text-align: right;
    margin: 0px;
    padding: 2px;
    background: #EFEFEF;
    position: relative; top: -10px; left: 0px;
} 

/* Common to all section text, including first section */
div.SectionText{margin-left: 10px;margin-right: 10px;margin-top: 10px;margin-bottom: 10px;   }

/* Contents or Summary */
h2{font-family:"Verdana", sans-serif;font-size: 11pt;font-weight: bold;text-align: left;margin-left: 5px;margin-right: 0pt;margin-top: 5pt;margin-bottom: 2pt;}

/* Table of Contents */
div.Toc{margin-top: 30px;margin-bottom: 30px;  border: 1px solid #CCCCCC;  padding: 5px;  margin-left: 30px;  margin-right: 30px;    }
div.TocLinks{font-weight: normal;text-align: left;margin-left: 0pt;margin-right: 0pt;margin-top: 0pt;margin-bottom: 0pt;}
ul.TocLinks{}
li.TocLink{}
a.TocLink{}

/* Summary */
div.Summary{margin-top: 20px;margin-bottom: 40px;    padding: 5px;  margin-left: 30px;  margin-right: 20px; }
table.SummaryTable{  margin-top: 15px;  margin-bottom: 15px;  background-color: transparent;                   }
tr.SummaryRow { }
td.SummaryLink{font-weight: normal;text-align: left;width: 15%;        padding: 5px;             }
td.SummaryText{text-align: left;      padding: 5px;  background-color: transparent;  color: Black;                    }
a.SummaryLink{ }

/* Sections */
div.AllSections{margin-top: 0;margin-bottom: 70px;  margin-left: 0;  margin-right: 0;  }

div.Section{margin-top: 30px;margin-bottom: 10px;}
h3{font-family:"Verdana", sans-serif;font-size: 11pt;font-weight: bold;text-align: left;margin-left: 0pt;margin-right: 0pt;margin-top: 5pt;margin-bottom: 10px;  padding-left: 10px;  padding-bottom: 3px;  background: #6699CC;  color: White;  border-bottom: 1px solid Black;     }

/* API Box */
div.Api{font-family:"Courier New", monospace;font-size: 9pt;margin-left: 15px;margin-right: 15px;margin-top: 15px;margin-bottom: 15px;padding: 7px;color: Black;  border: 1px solid #CCCCCC;  background: transparent;  }
font.ApiName{font-weight: bold;  background-color: transparent;  color: Black;  }

/* Section Text Elements */
h4{font-family:"Verdana", sans-serif;font-size: 9pt;font-weight: bold;margin-left: 0pt;margin-right: 0pt;margin-top: 5pt;margin-bottom: 2pt;}
pre{font-family:"Courier New", monospace;font-size: 11px;white-space: pre;margin-top: 7pt;margin-bottom: 7pt;  border: 1px dashed #CCCCCC;  padding: 5px;  margin-left: 5px;  margin-right: 5px;  color: Black;     }
font.HighText{ background-color: #FFFF00; color: Black;  font-weight: normal;}
ul{}
li{list-style: disc;}
a:link{text-decoration:none;color: #005499;background: transparent;}
a:visited{text-decoration:none;color: #005499;background: transparent;}
a:active{text-decoration:none;color: #005499;background: transparent;}
a:hover{text-decoration:underline;color: #005499;background: transparent;}
	
	/* Definitions Table */
table.DefTable{ margin-left: 20px;  margin-right: 20px;   }
tr.Def{  }
td.Def{font-family:"Courier New", monospace;font-size: 9pt;  font-weight: normal;   padding-left: 5px;  padding-right: 5px;      color: Black;  vertical-align: top;  white-space: nowrap;  text-align: left;            }
td.DefSep{font-family:"Courier New", monospace;font-size: 9pt;padding-right: 5pt;padding-left: 5pt;  vertical-align: top;  text-align: center;  }
td.DefText{ vertical-align: top;  text-align: left;  }

/* Copyright */
div.Copy { padding: 10px;  }

/* Footer */
div.Footer{ border-top: 1px solid #CCCCCC;  margin-top: 10px;  padding: 5px;  border-bottom: 1px solid #CCCCCC;    }

div.SourceLocation{background: transparent;color: rgb(130,130,130);  font-size: 8pt;  margin-bottom: 10px;  margin-left: 10px;   }
div.LastGenerated{background: transparent;color: rgb(130,130,130);  font-size: 8pt;  margin-left: 40px;  }


/* Navigation */
body.Side{background: #6699CC;color: White;  margin: 0px;  padding: 0px;  }
div.Side{}
/* not well supported in some versions of IE; remove background color and bottom border */
/*div.SideTitle{font-family:"Verdana", sans-serif;font-size: 14px;color: White;font-weight: bold;text-align: left;margin-left: 0pt;margin-right: 0pt;margin-top: 0px;margin-bottom: 0px;  background-color: #006699;  padding-top: 15px;  padding-bottom: 15px;  padding-left: 5px;  border-bottom: 4px solid Black;} */
div.SideTitle{font-family:"Verdana", sans-serif;font-size: 14px;color: #000000;font-weight: bold;text-align: left;margin-left: 0pt;margin-right: 0pt;margin-top: 0px;margin-bottom: 0px;  padding-top: 15px;  padding-bottom: 15px;  padding-left: 7px; }
div.SideText{text-align: left;margin-top: 0px;margin-bottom: 5px;  margin-left: 0px;  margin-right: 0px;  padding-bottom: 9px;    padding-left: 7px;  color: #FFCC00;  background: #6699CC;  padding-top: 10px;  font-weight: bold;               }
div.SideDetail { font-family: Arial, serif;  font-size: 10pt;  font-weight: normal;  background: transparent;    margin: 0px;  background-color: transparent;  padding-top: 1px;  color: White;                              }
ul.SideDetail{     }
li.SideDetail{ white-space: nowrap;  list-style: square;        }
a.SideDetail:link { text-decoration: none; color: #ffffff; font-family: Verdana, Arial, sans-serif; font-size: 12px; font-weight: bold; }
a.SideDetail:visited { text-decoration: none; color: #ffffff; font-family: Verdana, Arial, sans-serif; font-size: 12px; font-weight: bold; }
a.SideDetail:hover { text-decoration: underline; color: #ffffff; font-family: Verdana, Arial, sans-serif; font-size: 12px; font-weight: bold; }
table.LinksTable{margin-top: 10px;margin-bottom: 10px; padding-left: 7px;      }
tr.SideLink{}
td.SideLink{}
a.SideLink:link { text-decoration: none; color: #ffffff; font-family: Verdana, Arial, sans-serif; font-size: 11px; }
a.SideLink:visited { text-decoration: none; color: #ffffff; font-family: Verdana, Arial, sans-serif; font-size: 11px; }
a.SideLink:hover { text-decoration: underline; color: #ffffff; font-family: Verdana, Arial, sans-serif; font-size: 11px; }







-->

</style>

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="TwinText">

</head>
<body class=Main>
<h1>
FlashFX API: Driver Framework: Compaction
</h1>
<div class=Feedback><a href="mailto:support@datalight.com?subject=Documentation Feedback: FlashFX Tera SDK for Microsoft Windows CE -- v2.1.1 Build 2128DF (Win32 Host): FlashFX API: Driver Framework: Compaction">Send comments on this topic.</a></div>
<div class=SectionText>

    This module contains Device Driver Framework functions that are used
    to manage background compaction.

<p>
                                                                                                    
</div>
<div class=Summary>
<h2>
Summary
</h2>
<table class=SummaryTable>
<tr class=SummaryRow>
<td class=SummaryLink>
<a class=SummaryLink HREF="#FfxDriverDiskCompactAggressive">FfxDriverDiskCompactAggressive</a>&nbsp;&nbsp;
</td>
<td class=SummaryText valign=top>

    Aggressively compact the Disk until nothing more can be recovered.
</td>
</tr>
<tr class=SummaryRow>
<td class=SummaryLink>
<a class=SummaryLink HREF="#FfxDriverDiskCompactIfIdle">FfxDriverDiskCompactIfIdle</a>&nbsp;&nbsp;
</td>
<td class=SummaryText valign=top>

    Compact the flash according to the specified criteria if the
    flash manager has been idle.
</td>
</tr>
<tr class=SummaryRow>
<td class=SummaryLink>
<a class=SummaryLink HREF="#FfxDriverDiskCompactResume">FfxDriverDiskCompactResume</a>&nbsp;&nbsp;
</td>
<td class=SummaryText valign=top>

    Resume background compaction operations.
</td>
</tr>
<tr class=SummaryRow>
<td class=SummaryLink>
<a class=SummaryLink HREF="#FfxDriverDiskCompactSuspend">FfxDriverDiskCompactSuspend</a>&nbsp;&nbsp;
</td>
<td class=SummaryText valign=top>

    Wait until the current compaction operation (if any) is completed,
    and suspend any new background compactions.
</td>
</tr>
</table>
</div>
<div class=AllSections>
<div class=Section>
<h3>
<a NAME="FfxDriverDiskCompactAggressive"></a>
<a NAME="FfxDriverDiskCompactAggressive"></a>
FfxDriverDiskCompactAggressive
</h3>
<div class=Api>
<a HREF=QF660_Structures.c.htm#FFXIOSTATUS>FFXIOSTATUS</a> <font class=ApiName>FfxDriverDiskCompactAggressive</font>(
    <a HREF=QF660_Structures.c.htm#FFXDISKHANDLE>FFXDISKHANDLE</a>   hDisk)
</div>
<div class=SectionText>

    Aggressively compact the Disk until nothing more can be recovered. 

<p>    Use this function with caution, as it will aggressively compact
    the flash, and may result in shortened flash life.

<p>    <h4>Parameters</h4>
        
<p><table class=DefTable>
<tr class=Def>
<td class=Def>
hVBF
</td>
<td class=DefSep>-</td>
<td class=DefText>
The handle denoting the VBF instance to use.
</td>
</tr>
</table>

<p>
    <h4>Return Value</h4>
        Returns the number of pages which were compacted.

<p>

</div>
</div>
<div class=Section>
<h3>
<a NAME="FfxDriverDiskCompactIfIdle"></a>
<a NAME="FfxDriverDiskCompactIfIdle"></a>
FfxDriverDiskCompactIfIdle
</h3>
<div class=Api>
<a HREF=UD660_DataTypes.c.htm#D_UINT32>D_UINT32</a> <font class=ApiName>FfxDriverDiskCompactIfIdle</font>(<br>&nbsp;&nbsp;&nbsp; 
    <a HREF=QF660_Structures.c.htm#FFXDISKHANDLE>FFXDISKHANDLE</a>   hDisk,<br>&nbsp;&nbsp;&nbsp;
    <a HREF=UD660_DataTypes.c.htm#D_UINT32>D_UINT32</a>        ulFlags)
</div>
<div class=SectionText>

    Compact the flash according to the specified criteria if the
    flash manager has been idle.

<p>    During normal write operations, synchronous compactions will
    occur frequently and are sometimes long processes.  This function
    forces a compaction to occur immediately.  It can provide an
    apparent performance boost by creating more space that is
    writeable, and therefore reduce the frequency of synchronous
    compactions.  Higher level modules may call this interface to
    perform cleanup during idle time.

<p>    Note that this function exists independently from the "Background
    Compaction" feature, which requires thread support.  it may be
    called from OS specific code where idle time execution paths may
    be modified to allow FlashFX to do compaction.

<p>    The level specified by ulFlags must be one of the following
    values:
      
<p><table class=DefTable>
<tr class=Def>
<td class=Def>
FFX_COMPACTFLAGS_MILD
</td>
<td class=DefSep>-</td>
<td class=DefText>
Only Erase Units which are highly
                                    qualified (almost completely
                                    dirty) will be compacted.
</td>
</tr>

<p>      
<tr class=Def>
<td class=Def>
FFX_COMPACTFLAGS_GOOD
</td>
<td class=DefSep>-</td>
<td class=DefText>
Only Erase Units which are very
                                    well qualified (or better) will
                                    be compacted.
</td>
</tr>

<p>      
<tr class=Def>
<td class=Def>
FFX_COMPACTFLAGS_NORMAL
</td>
<td class=DefSep>-</td>
<td class=DefText>
Any Erase Unit which meets the
                                    background compaction threshold
                                    may be compacted.
</td>
</tr>

<p>      
<tr class=Def>
<td class=Def>
FFX_COMPACTFLAGS_EVERYTHING
</td>
<td class=DefSep>-</td>
<td class=DefText>
Any Erase Unit which is dirty at
                                    all may be compacted.
</td>
</tr>
</table>

<p>
    Regardless of the level specified, the dirtiest Erase Unit
    available will be compacted.  Regardless how dirty the flash
    may be, this function never compacts more than one Erase Unit
    in a given call.

<p>    Use FFX_COMPACTFLAGS_EVERYTHING with caution, as it will
    aggressively compact the flash, and may result in shortened
    flash life.

<p>    If the return value is anything other than 0 or 1, there is
    potentially information to compact, however not enough idle time
    has elapsed since the last I/O operation.  The value indicates
    the minimum number of milliseconds that the system <should> wait,
    before attempting another compaction.  This is based on the
    longest read/write idle time.  Trying to compact again at an
    earlier time will have no ill-effect, but will not do anything.

<p>    <h4>Parameters</h4>
        
<p><table class=DefTable>
<tr class=Def>
<td class=Def>
hVBF
</td>
<td class=DefSep>-</td>
<td class=DefText>
The handle denoting the VBF instance to use
</td>
</tr>

<p>        
<tr class=Def>
<td class=Def>
ulFlags
</td>
<td class=DefSep>-</td>
<td class=DefText>
This is the level of compaction which is
                  desired, as described above.
</td>
</tr>
</table>

<p>
    <h4>Return Value</h4>
        
<p><table class=DefTable>
<tr class=Def>
<td class=Def>
0
</td>
<td class=DefSep>-</td>
<td class=DefText>
A compaction was attempted, but there is nothing to do
</td>
</tr>

<p>        
<tr class=Def>
<td class=Def>
1
</td>
<td class=DefSep>-</td>
<td class=DefText>
A compaction was successfully performed
</td>
</tr>

<p>        
<tr class=Def>
<td class=Def>
n
</td>
<td class=DefSep>-</td>
<td class=DefText>
No attempt made, should wait at least n milliseconds
</td>
</tr>
</table>

<p>


</div>
</div>
<div class=Section>
<h3>
<a NAME="FfxDriverDiskCompactResume"></a>
<a NAME="FfxDriverDiskCompactResume"></a>
FfxDriverDiskCompactResume
</h3>
<div class=Api>
<a HREF=QF660_Structures.c.htm#FFXSTATUS>FFXSTATUS</a> <font class=ApiName>FfxDriverDiskCompactResume</font>(
    FFXDISKINFO    *pDsk)
</div>
<div class=SectionText>

    Resume background compaction operations.

<p>    <b>Note</b> -- It is acceptable to call this function even when
          background compaction is already running.

<p>    <h4>Parameters</h4>
        
<p><table class=DefTable>
<tr class=Def>
<td class=Def>
pDsk
</td>
<td class=DefSep>-</td>
<td class=DefText>
A pointer to the FFXDSKINFO structure to use
</td>
</tr>
</table>

<p>
    <h4>Return Value</h4>
        Returns an <a HREF=QF660_Structures.c.htm#FFXSTATUS>FFXSTATUS</a> code indicating success or failure.

<p>

</div>
</div>
<div class=Section>
<h3>
<a NAME="FfxDriverDiskCompactSuspend"></a>
<a NAME="FfxDriverDiskCompactSuspend"></a>
FfxDriverDiskCompactSuspend
</h3>
<div class=Api>
<a HREF=QF660_Structures.c.htm#FFXSTATUS>FFXSTATUS</a> <font class=ApiName>FfxDriverDiskCompactSuspend</font>(
    FFXDISKINFO    *pDsk)
</div>
<div class=SectionText>

    Wait until the current compaction operation (if any) is completed,
    and suspend any new background compactions.

<p>    <b>Note</b> -- It is acceptable to call this function even when
              background compaction is already suspended.

<p>    <h4>Parameters</h4>
        
<p><table class=DefTable>
<tr class=Def>
<td class=Def>
pDsk
</td>
<td class=DefSep>-</td>
<td class=DefText>
A pointer to the FFXDSKINFO structure to use
</td>
</tr>
</table>

<p>
    <h4>Return Value</h4>
        Returns one of the following <a HREF=QF660_Structures.c.htm#FFXSTATUS>FFXSTATUS</a> codes:
          <ul>
<li>FFXSTAT_SUCCESS
          <li>FFXSTAT_DRVCOMPACTNOTENABLED
          <li>FFXSTAT_DRVCOMPACTALREADYSUSPENDED
          <li>FFXSTAT_DRVCOMPACTSUSPENDFAILED
</ul>


</div>
</div>
</div>
<div class=Copy>Datalight FlashFX Tera SDK for Microsoft Windows CE<br>Copyright &#169; 1993-2012 Datalight, Inc.  All Rights Reserved Worldwide.</div>
</body>
</html>

